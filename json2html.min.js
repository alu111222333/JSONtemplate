/**
 * The simplest "JSON->HTML" templater with multilanguage support
 * Author: Leonid Arefev
 * Started: 11-05-2013
 * GitHub: https://github.com/wtf-develop/json2html
 * Web: http://wtf-dev.ru/
 */
var $jscomp={scope:{},checkStringArgs:function(b,v,l){if(null==b)throw new TypeError("The 'this' value for String.prototype."+l+" must not be null or undefined");if(v instanceof RegExp)throw new TypeError("First argument to String.prototype."+l+" must not be a regular expression");return b+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,v,l){if(l.get||l.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[v]=l.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,v,l,x){if(v){l=$jscomp.global;b=b.split(".");for(x=0;x<b.length-1;x++){var r=b[x];r in l||(l[r]={});l=l[r]}b=b[b.length-1];x=l[b];v=v(x);v!=x&&null!=v&&$jscomp.defineProperty(l,b,{configurable:!0,writable:!0,value:v})}};
$jscomp.polyfill("String.prototype.endsWith",function(b){return b?b:function(b,l){var v=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===l&&(l=v.length);for(var r=Math.max(0,Math.min(l|0,v.length)),h=b.length;0<h&&0<r;)if(v[--r]!=b[--h])return!1;return 0>=h}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(b,l){var v=$jscomp.checkStringArgs(this,b,"startsWith");b+="";for(var r=v.length,h=b.length,p=Math.max(0,Math.min(l|0,v.length)),y=0;y<h&&p<r;)if(v[p++]!=b[y++])return!1;return y>=h}},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(b){return b?b:function(b){return"number"!==typeof b?!1:!isNaN(b)&&Infinity!==b&&-Infinity!==b}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(b){return b?b:function(b){return Number.isFinite(b)?b===Math.floor(b):!1}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var v=0;return $jscomp.iteratorPrototype(function(){return v<b.length?{done:!1,value:b[v++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,v){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var l=0,x={next:function(){if(l<b.length){var r=l++;return{value:v(r,b[r]),done:!1}}x.next=function(){return{done:!0,value:void 0}};return x.next()}};x[Symbol.iterator]=function(){return x};return x};
$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");
if(void 0===jth||void 0===json2html)var json2html=function(){function b(a,c,b){b="undefined"==typeof b?!1:b;if(void 0===c||null==c||0==c.length)return!1;var g,d;for(d in a){g=a[d];if(g==c)return!0;if(b){var e=g.indexOf("*");if(0==e){if(c.endsWith(g.substr(1)))return!0}else if(e==g.length-1&&c.startsWith(g.substr(0,g.length-1)))return!0}}return!1}function v(a,c,b){if(void 0===c)return G&&alert("Json2Html: CRITICAL error. Varialble name is undefined. Check your loop templates"),console.log("Json2Html: CRITICAL error. Varialble name is undefined. Check your loop templates"),
"";c=p(c);var g,d=c.split(".");for(g=0;g<d.length;g++)if(d[g]=l(p(d[g])),"this"!=d[g]){if("vardump"==d[g])return K(a);if("length"==d[g]&&Array.isArray(a))return a.length;if("random"==d[g])return Math.floor(1E5*Math.random()+1);if("instance_id"==d[g])return b;if(void 0!==a&&null!==a&&void 0!==a[d[g]])a=a[d[g]];else{G&&-1==I.indexOf(d[g])&&(I=I+d[g]+" in ("+c+")\n");a="";break}}if(void 0===a||null===a)a="";return a}function l(a){if(null===a)return"";if("string"!=typeof a||3>a.length)return a;'"'==a.charAt(0)&&
'"'==a.charAt(a.length-1)&&(a=a.substr(1,a.length-2));"'"==a.charAt(0)&&"'"==a.charAt(a.length-1)&&(a=a.substr(1,a.length-2));"`"==a.charAt(0)&&"`"==a.charAt(a.length-1)&&(a=a.substr(1,a.length-2));return a}function x(a,c){function b(a){d=a;d=h("if=`","",d);d=h("`","",d);d=p(d);return 1>d.length?!1:!0}function g(a){if(1>d.length)return!0;a={obj:a,func:function(){return!!eval("function __hey(obj){return ("+d+");}; __hey(this.obj);")}};try{return a.func()}catch(Z){y("debug error in filter!\n"+d+"\n"+
Z.name)}return!1}var d="",e=L,P=U;U++;c=p(l(c));var k=-1,F="",f="";G&&0==M&&(I="");if(15<M)return y("stack overflow in parser detect"),"";if(void 0===e[c])return y("template "+c+" is UNDEFINED"),"";M++;var e=e[c],q=0,n=0,w,t,m,u,z=t=-1,r="",B="",A=-1;w=-1;for(n=q=0;-1!=e.indexOf(C[0],q);)if(q=e.indexOf(C[0],q),n=e.indexOf(C[1],q+C[0].length),A=z=t=-1,B=r="",w=-1,f=m=k="",-1!=n&&155>n-q&&0<n-q){u=n=e.substr(q+C[0].length,n-(q+C[0].length));f="";-1!=n.indexOf(",")&&(f=n.split(","),u=f[0],void 0!==f[1]&&
0==f[1].indexOf("hash32")?(A=1,f=""):void 0!==f[1]&&-1!=f[1].indexOf("replace=")?(-1!=f[1].indexOf("`with`")&&(f[1]=f[1].split("`with`"),r=f[1][0],B=f[1][1],r=h("replace=","",r),r=h("`","",r),B=h("replace=","",B),B=h("`","",B),z=0<r.length?r.length:-1),f=""):void 0!==f[1]&&-1!=f[1].indexOf("crop=")?(t=parseInt(l(h("crop=","",f[1]))),1>t&&(t=-1),f=""):void 0!==f[1]&&-1!=f[1].indexOf("ift=`")?(w=1,m=k="",-1!=f[1].indexOf("`then`")?(f[1]=f[1].split("`then`"),k=f[1][1],m=k.split("`else`")):(then_n=void 0,
m=f[1].split("`else`")),void 0===m[1]?m=void 0:(k=m[0],m=m[1]),f[1]=h("ift=","",f[1][0]),f[1]=p(h("`","",f[1])),void 0!==m&&(m=p(h("`","",m))),void 0!==k&&(k=p(h("`","",k)))):void 0===f[1]||-1==f[1].indexOf("ifc=`")&&-1==f[1].indexOf("if=`")?void 0!==f[1]&&-1!=f[1].indexOf("ifb=`")?(w=3,m=k="",-1!=f[1].indexOf("`then`")?(f[1]=f[1].split("`then`"),k=f[1][1],m=k.split("`else`")):(then_n=void 0,m=f[1].split("`else`")),void 0===m[1]?m=void 0:(k=m[0],m=m[1]),f[1]=h("ifb=","",f[1][0]),f[1]=p(h("`","",f[1])),
void 0!==m&&(m=p(h("`","",m))),void 0!==k&&(k=p(h("`","",k)))):f="":(w=2,m=k="",-1!=f[1].indexOf("`then`")?(f[1]=f[1].split("`then`"),k=f[1][1],m=k.split("`else`")):(then_n=void 0,m=f[1].split("`else`")),void 0===m[1]?m=void 0:(k=m[0],m=m[1]),-1!=f[1][0].indexOf("ifc=")?f[1]=h("ifc=","",f[1][0]):f[1]=h("if=","",f[1][0]),f[1]=p(h("`","",f[1])),void 0!==m&&(m=p(h("`","",m))),void 0!==k&&(k=p(h("`","",k)))));u=v(a,u,P);if(0<A)u=aa(u);else if(0<z)u=h(r,B,u);else if(0<t)u.length>t&&(u=u.substr(0,t)+"...");
else if((1==w||2==w)&&void 0!==f[1]){t=f[1].toString().toUpperCase();f=!1;if(-1!=t.indexOf("||"))for(t=t.split("||"),z=z=0;z<t.length&&(f||!(f=u.toString().toUpperCase()==t[z]));z++);else f=u.toString().toUpperCase()==t;f?void 0!==k&&""!=k?u=1==w?x(a,k):p(l(k)):void 0!==k&&(u=""):void 0!==m&&""!=m?u=1==w?x(a,m):p(l(m)):void 0!==m&&(u="")}else if(3==w&&void 0!==f[1]){f=f[1].toString();t=0;z=!0;r=parseInt(u);if(isNaN(r))z=!1;else for(t=0;t<f.length;t++)if(z&&(B=f.charAt(t),"1"==B||"0"==B))if(0!=(r>>
t)%2){if("0"==B){z=!1;break}}else if("1"==B){z=!1;break}z?void 0!==k&&""!=k?u=1==w?x(a,k):p(l(k)):void 0!==k&&(u=""):void 0!==m&&""!=m?u=1==w?x(a,m):p(l(m)):void 0!==m&&(u="")}e=h(C[0]+n+C[1],u+"",e)}else y("too long or short variable in "+c+" on "+e.substr(q,n-q)),q+=1;n=q=0;for(f="";-1!=e.indexOf(D[0],q);)if(w=k=t=-1,q=e.indexOf(D[0],q),n=e.indexOf(D[1],q+D[0].length),f="",b(f),m="",-1!=n&&195>n-q&&0<n-q){w=e.substr(q+D[0].length,n-(q+D[0].length));u=w.split(",");m="";n=2;f="";for(n=2;n<u.length;n++)f=
u[n],-1!=f.indexOf("if=`")?b(f):-1!=f.indexOf("limit=`")?(k=parseInt(h("limit=","",h("`","",f))),1>k&&(k=-1)):-1!=f.indexOf("default=`")&&(F=h("default=","",h("`","",f)));f=a;n=u[0];f=v(a,l(n),P);t=0;z=f.length-1;0>z&&(m=m+F+"",y("No data in this array! "+n));n=0;r=f.length;for(n in f){r--;if(0<k&&t>=k)break;g(f[n])&&("object"==typeof f[n]&&(f[n].json2html_counter=t+"",f[n].json2html_key=n+"",0==t&&(f[n].json2html_first="1"),t==z&&(f[n].json2html_last="1"),0==(t+1)%2?f[n].json2html_even="1":f[n].json2html_odd=
"1"),m+=x(f[n],u[1]),t++)}e=h(D[0]+w+D[1],m,e)}else y("too long or short Foreach[!..!] in "+c+" on "+e.substr(q,n-q)),q+=1;for(n=q=0;-1!=e.indexOf(E[0],q);)w=t=-1,q=e.indexOf(E[0],q),n=e.indexOf(E[1],q+E[0].length),F=a,-1!=n&&95>n-q&&0<n-q?(n=w=e.substr(q+E[0].length,n-(q+E[0].length)),-1!=w.indexOf(",")&&(w=w.split(",",2),k=w[1],w=w[0],F=v(F,k,P)),e=h(E[0]+n+E[1],x(F,w),e)):(y("too long or short template{{..}} in "+c+" on "+e.substr(q,n-q)),q+=1);M--;G&&""!=I&&0==M&&(I="");return p(e)}function r(a){a=
Array.prototype.slice.call(a.getElementsByTagName("script"));for(var c=0;c<a.length;c++){if(""!=a[c].src){var b=document.getElementsByTagName("head")[0],g=p(a[c].src),d=h(".","_",h(":","_",h("/","_",g)));if(!document.getElementById(d)){var e=document.createElement("script");e.src=g;e.id=d;b.appendChild(e)}}else eval(a[c].innerHTML);a[c].parentElement.removeChild(a[c])}}function h(a,c,b){return void 0===b?b:String.prototype.replaceAll?b.replaceAll(a,c):b.split(a).join(c)}function p(a){return void 0===
a||null===a||1>a.length?"":String.prototype.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function y(a){G&&console.log("Json2Html: "+a)}function K(a,c){var b="undefined"==typeof c?1:c,g="";b||(b=0);for(var d="",e=0;e<b+1;e++)d+="    ";if("object"==typeof a)for(var h in a)e=a[h],"object"==typeof e?(g+=d+"'"+h+"' :\n",g+=K(e,b+1)):g+=d+"'"+h+"' => \""+e+'"\n';else g="===>"+a+"<===("+typeof a+")";return g}function O(a,c,b,g){g="undefined"==typeof g?500:g;G&&y("Network: "+c+"\n"+K(b));
a(JSON.parse('{"error":{"state":true,"title":"Network error","message":"'+h("'","",h('"',"",c))+'","code":'+g+"}}"))}function Q(a,c,b,g,d){var e={mode:"same-origin",cache:"no-cache",credentials:"same-origin",redirect:"follow"},h="JSON"==p(c).toUpperCase();"POST"==p(a).toUpperCase()?(e.method="POST",e.body=JSON.stringify(g),e.headers={"Content-Type":"application/json",Accept:h?"application/json":"text/html"}):(e.method="GET",e.headers={Accept:h?"application/json":"text/html"});fetch(b,e).then(function(a){if(!a.ok)throw Error(a.statusText);
return h?a.json():a.text()}).then(function(a){d(a)})["catch"](function(a){h?O(d,a.message,a):(G&&y(textStatus+"\n"+K(errorThrown)),alert('json2html: "'+b+'" '+a.message))})}function R(a,c,b,g,d){var e=new XMLHttpRequest;e.withCredentials=!0;var h="JSON"==p(c).toUpperCase();a="POST"==p(a).toUpperCase();e.onload=function(a){if(4==e.readyState)if(200==e.status)if(a=e.responseText,h)try{d(JSON.parse(a))}catch(F){O(d,F.name,F,e.status)}else d(a);else O(d,"Wrong status "+e.status,{error:"XMLHttpRequest",
status:e.status},e.status)};e.onerror=function(a){O(d,e.statusText,a,e.status)};e.open(a?"POST":"GET",b,!0);a?(e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Accept",h?"application/json":"text/html"),e.send(JSON.stringify(g))):(e.setRequestHeader("Accept",h?"application/json":"text/html"),e.send())}function J(a,c,b){a=p(a);var g=[];if(2==a.length)g.push(a.charAt(0)+" "+a.charAt(1));else if(3==a.length)g.push(a.charAt(0)+" "+a.charAt(1)+a.charAt(2)),g.push(a.charAt(0)+a.charAt(1)+
" "+a.charAt(2)),g.push(a.charAt(0)+" "+a.charAt(1)+" "+a.charAt(2));else return c;b?(g.push(a+"  "),g.push(a+" ")):(g.push("  "+a),g.push(" "+a));for(b=0;b<g.length;b++)c=h(g[b],a,c);return c}function ba(a,c,b){void 0===c?y("Undefined URL in templates array"):(H++,"fetch"in window?Q("get","text",c,null,function(g){V(g,a,b,c)}):R("get","text",c,null,function(g){V(g,a,b,c)}))}function V(a,c,b,g){g=g.substring(g.lastIndexOf("/")+1);g=p(g.substring(0,g.lastIndexOf(".")));if(a.match(/^\s*?NextTemplateName:\s*?\S{1,100}\s*?$/m)){y("File with templates detected: "+
g);a=a.split("NextTemplateName:");var d;for(d=0;d<a.length;d++){var e=a[d].indexOf("\n"),h;if(0<d){if(0>e||100<e){y("Strange template loaded from file "+g+'. All templates should be starter with line "NextTemplateName: name_of_template"');y(a[d]);continue}h=p(a[d].substring(0,e));e=p(a[d].substring(e+1))}else{e=p(a[d]);if(0==e.length){y('thete is nothing in first "'+g+'" of the content '+d);continue}h=g}0==e.length?y("thete is nothing in one of the content "+d):(0==h.length&&(y("thete is no title in one of the templates "+
d),h=g),c[h]=e,y("Loaded template "+h+" from file "+g))}}else c[g]=a,y("Loaded file "+g);H--;0==H&&b()}function W(a){var c={};a=a.querySelectorAll("input, select, textarea");for(var b=0;b<a.length;++b){var g=a[b],d=g.name;if(d){var e=g.value;"INPUT"==g.tagName.toUpperCase()&&"CHECKBOX"==g.type.toUpperCase()&&(g.checked||(e+="__false"));var l=c,k=d;if(/\[.*?\]/.test(k)){var p=k.split("[")[0],d=k.match(/\[.*?\]/g),g=d.length,k=-1!=k.indexOf("[]");void 0===l[p]&&(l[p]=1==g&&k?[]:{});p=l[p];for(l=0;l<
g;l++){var f=h("[","",h("]","",d[l]));l==g-1?""==f?Array.isArray(p)&&p.push(e):p[f]=e:(void 0===p[f]&&(p[f]=l==g-2&&k?[]:{}),p=p[f])}}else void 0===l[k]&&(l[k]=e)}}return c}function X(){if(!(1>H))return!1;var a=L,c;for(c in a)a[c]=J(C[0],a[c],!0),a[c]=J(C[1],a[c],!1),a[c]=J(D[0],a[c],!0),a[c]=J(D[1],a[c],!1),a[c]=J(E[0],a[c],!0),a[c]=J(E[1],a[c],!1),a[c]=h("` then","`then",a[c]),a[c]=h("then `","then`",a[c]),a[c]=h("` else","`else",a[c]),a[c]=h("else `","else`",a[c]),a[c]=h("if = `","if=`",a[c]),
a[c]=h("if= `","if=`",a[c]),a[c]=h("if =`","if=`",a[c]);S(L);Y()}function aa(a){var c=ca,b,g,d,e;b=a.length&3;g=a.length-b;d=c;for(c=0;c<g;)e=a.charCodeAt(c)&255|(a.charCodeAt(++c)&255)<<8|(a.charCodeAt(++c)&255)<<16|(a.charCodeAt(++c)&255)<<24,++c,e=3432918353*(e&65535)+((3432918353*(e>>>16)&65535)<<16)&4294967295,e=e<<15|e>>>17,e=461845907*(e&65535)+((461845907*(e>>>16)&65535)<<16)&4294967295,d^=e,d=d<<13|d>>>19,d=5*(d&65535)+((5*(d>>>16)&65535)<<16)&4294967295,d=(d&65535)+27492+(((d>>>16)+58964&
65535)<<16);e=0;switch(b){case 3:e^=(a.charCodeAt(c+2)&255)<<16;case 2:e^=(a.charCodeAt(c+1)&255)<<8;case 1:e^=a.charCodeAt(c)&255,e=3432918353*(e&65535)+((3432918353*(e>>>16)&65535)<<16)&4294967295,e=e<<15|e>>>17,d^=461845907*(e&65535)+((461845907*(e>>>16)&65535)<<16)&4294967295}d^=a.length;d^=d>>>16;d=2246822507*(d&65535)+((2246822507*(d>>>16)&65535)<<16)&4294967295;d^=d>>>13;d=3266489909*(d&65535)+((3266489909*(d>>>16)&65535)<<16)&4294967295;return(d^d>>>16)>>>0}function S(a,c){var h="undefined"==
typeof c?[]:c;if(void 0===a)return"";if(null===a||Number.isInteger(a)||void 0===A||null===A||"object"!=typeof A)return a;if("string"===typeof a)return T(a);N--;if(0>N)return N++,alert("Stackoverflow protection triggered"),N=10,a;var g=!1;Array.isArray(h)&&0<h.length&&(g=!0);for(var d in a)if(void 0!==a[d]&&null!==a[d]&&!Number.isInteger(a[d]))if(Array.isArray(a[d])||"object"==typeof a[d])S(a[d],h);else if("string"===typeof a[d]||a[d]instanceof String)g?b(h,d,!0)&&(a[d]=T(a[d])):a[d]=T(a[d]);N++;return a}
function T(a){if(void 0===a)return"";if(void 0===A||null===A||"object"!=typeof A)return a;var c,b;if(0>a.length-7)return a;for(var g,d=a.indexOf("@str."),e=300;-1!=d;){e--;if(0>e){alert("Loop protection: JS template library");break}b=d+5;a:{c=b;g=a;var h,k,l=-1,f=g.length;for(h=0;41>h;h++){l=c+h;if(l>=f){c=f;break a}k=g.charCodeAt(l);if(!(48<=k&&57>=k||65<=k&&90>=k||97<=k&&122>=k||95==k)){c=l;break a}}c=l}g=c-b;2<g||40>g?(b=a.substr(b,g),void 0!==A[b]?(a=a.replace("@str."+b,A[b]),d=a.indexOf("@str.",
d+1)):(console.log('No translation for key: "'+b+'"'),d=a.indexOf("@str.",c))):d=a.indexOf("@str.",c)}return a}var G=!1,C=["{{","}}"],D=["{+","+}"],E=["{:",":}"],I="",U=Math.floor(999*Math.random()+1),M=0,H=0;if(void 0!==jQuery)try{jQuery.fn.serializeHtmlForm=function(){return W(this[0])},jQuery.fn.injectJSON=function(a,b){var c=x(a,b);this.each(function(){jQuery(this).html(c);r(jQuery(this)[0])});return this}}catch(a){}var Y=0,L={},ca=Math.round(1E4*Math.random()+1E4),N=10,A=null;return{render:x,
inject2DOM:function(a,b,h){var c=null;try{c=document.querySelectorAll(h)}catch(d){}if(void 0===c||null==c)return[];a=x(a,b);for(b=0;b<c.length;++b)h=c[b],"innerHTML"in h&&(h.innerHTML=a,r(h));return c},getJSON:function(a,b){"fetch"in window?Q("get","json",a,null,b):R("get","json",a,null,b)},postJSON:function(a,b,h){"fetch"in window?Q("post","json",a,b,h):R("post","json",a,b,h)},loadTemplatesArray:function(a,b,h){h="undefined"==typeof h?!0:h;1>H||alert("Critical error.\nTrying to load templates before previous templates request is completed");
h&&(L={});Y=b;H++;for(b=0;b<a.length;b++)ba(L,a[b],X);H--;X()},setTranslationArray:function(a){void 0===a?console.log("Translation array is undefined"):(A=a,0==Object.keys(A).length&&(A=null))},translate:S,executeJS:r,printObject:K,setDebug:function(a){G=a},serializeHtmlForm:function(a){a=document.querySelector(a);return void 0===a||null==a?{}:W(a)}}}(),jth=json2html;
